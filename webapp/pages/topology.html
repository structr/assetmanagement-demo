<!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><structr:template src="Main Page Template-a5217bf8d0ac4da3b7613e526779dfca" data-structr-meta-name="Main Page Template" data-structr-meta-id="2c3c858a022a45e4879abaa73c129f56"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!-- Content Row -->
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<div class="row" data-structr-meta-id="b90a79e85ed843edaa33545a074a414b"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Equipment-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-xl-3 col-md-4 mb-2" data-structr-meta-id="487791cfec724fca8840cb731b457582"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a href="/equipments" data-structr-meta-id="fcd7be985a324bdeb6e24de9195b299e">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card border-left-primary shadow h-100 py-2" data-structr-meta-id="1f8f922820af41c19bc5967b02b6f709">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="card-body" data-structr-meta-id="03fea41ef096413fab0f2d7388a79e22">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="row no-gutters align-items-center" data-structr-meta-id="89968fd0c0ab4a2d9278cb2216230f99">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col mr-2" data-structr-meta-id="ba2894a0199147daa081a3fdfb7dd0b9">
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="text-xs font-weight-bold text-primary text-uppercase mb-1" data-structr-meta-id="0b920a7d749c4a3a89666e6855eb1c3d"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Equipment</div>
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="h5 mb-0 font-weight-bold text-gray-800" data-structr-meta-id="bdd088d1a1fb449886ddf7047fd3821e"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${size(find('Demo_Equipment'))}</div>
							</div>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col-auto" data-structr-meta-id="3faa7c468f404c26ae92fea8f7cdc054"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i data-structr-meta-id="e07510d91f1648b78c3942418450e333"></i></div>
						</div>
					</div>
				</div>
			</a></div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Drawing-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-xl-3 col-md-4 mb-2" data-structr-meta-id="d521a89364e847e39a9050d77f3d7ae3"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a href="/drawings" data-structr-meta-id="4057fb3286ab4430b203f378476c648d">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card border-left-success shadow h-100 py-2" data-structr-meta-id="1a8c0d0ed5ad49a980fbd0acb37ddb07">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="card-body" data-structr-meta-id="efa5936a162e4e6582aca5e7a3d034c5">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="row no-gutters align-items-center" data-structr-meta-id="ff994fd5930d47f0b32432f6e5583d4c">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col mr-2" data-structr-meta-id="493384aff29645dd92ff8f2ce48e962b">
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="text-xs font-weight-bold text-success text-uppercase mb-1" data-structr-meta-id="4fe35c6714624db6ad714c4eebc90a49"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Drawings</div>
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="h5 mb-0 font-weight-bold text-gray-800" data-structr-meta-id="0e67ac357f1e4a2c8f4c5b92950b472c"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${size(find('Demo_Drawing'))}</div>
							</div>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col-auto" data-structr-meta-id="b7110b9c83154dc78d0296a5b841b5ab"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="/fas fa-paint-brush fa-2x text-gray-300" data-structr-meta-id="b370ae8e45644ff9aec5c4f2b4b095b7"></i></div>
						</div>
					</div>
				</div>
			</a></div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Datasheet-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-xl-3 col-md-4 mb-2" data-structr-meta-id="01982b6dabd246de8f1322fdb095a29d"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a href="/datasheets" data-structr-meta-id="d47e343b22784c7dabb1b8e704d6edad">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card border-left-info shadow h-100 py-2" data-structr-meta-id="1d93ebdb57c14d4e956d0c2d4891315d">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="card-body" data-structr-meta-id="b40ff6416d2f42e4ab6843c1bd87c131">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="row no-gutters align-items-center" data-structr-meta-id="0ddbc84107ca40e5b6fdc64e42f21c01">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col mr-2" data-structr-meta-id="7ad96012953b4c21a6611c1512646861">
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="text-xs font-weight-bold text-info text-uppercase mb-1" data-structr-meta-id="167ded2b721b4a3db3d1fb7acb0e6d20"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Datasheets</div>
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="row no-gutters align-items-center" data-structr-meta-id="dda8f8ee56544211ae8f5ec42996b9f4">
									<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
									<div class="col-auto" data-structr-meta-id="71650310937546dcb38ae05705f857aa">
										<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
										<div class="h5 mb-0 mr-3 font-weight-bold text-gray-800" data-structr-meta-id="e00660d52b8142b891643655f6cbb760"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${size(find('Demo_Datasheet'))}</div>
									</div>
								</div>
							</div>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col-auto" data-structr-meta-id="245e5b3fecc54cc7bb38021c005e6b42"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="fas fa-file-alt fa-2x text-gray-300" data-structr-meta-id="1c06178122b3453f8c4ca0031ce00c31"></i></div>
						</div>
					</div>
				</div>
			</a></div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Deliverable-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-xl-3 col-md-4 mb-2" data-structr-meta-id="ecf6059c5df04c82882b9f117804a5fd"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a href="/deliverables" data-structr-meta-id="eb2ff5bf5e35422f9cd6946bebacf3b4">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card border-left-warning shadow h-100 py-2" data-structr-meta-id="30a2df88f1e443ceaf64be5514c162ca">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="card-body" data-structr-meta-id="c45337608b414a8cac76c25902121f7c">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="row no-gutters align-items-center" data-structr-meta-id="167fbcd0dbac41739c6cfd596bbba80c">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col mr-2" data-structr-meta-id="dd6122e8e9e748059a2f50e888c6bc6a">
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="text-xs font-weight-bold text-warning text-uppercase mb-1" data-structr-meta-id="63d941d2655f4949b4f75cf5ddcff245"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Deliverables</div>
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="h5 mb-0 font-weight-bold text-gray-800" data-structr-meta-id="2063fec8ce984de1b4cd17d2e7b31f4a"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${size(find('Demo_Deliverable'))}</div>
							</div>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col-auto" data-structr-meta-id="1a26c423e3a249389e9abb0f06e86048"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="fas fa-truck fa-2x text-gray-300" data-structr-meta-id="e7ccebc2defe41419ffc81adf85c627d"></i></div>
						</div>
					</div>
				</div>
			</a></div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Workpack-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-xl-3 col-md-4 mb-2" data-structr-meta-id="fc5a521f1eb24fb0b3cb9cab63e1192c"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a href="/workpacks" data-structr-meta-id="7180acd56131460a9ff4a3efdb7d55d9">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card border-left-danger shadow h-100 py-2" data-structr-meta-id="57ff7f47e7f143bbb08cb6e8c1ad8bc4">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="card-body" data-structr-meta-id="ef528722e49a48fea7da8d011970e9a4">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="row no-gutters align-items-center" data-structr-meta-id="416d137bbab24331a76bac81bc47d023">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col mr-2" data-structr-meta-id="9896bb31cad44a71ac547034c5ed08f4">
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="text-xs font-weight-bold text-danger text-uppercase mb-1" data-structr-meta-id="b9a05ebf3e8f4910ba3e321c32551edf"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Workpack</div>
								<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
								<div class="h5 mb-0 font-weight-bold text-gray-800" data-structr-meta-id="45c024639bb146f89f4d2c7e07475565"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${size(find('Demo_Workpack'))}</div>
							</div>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="col-auto" data-structr-meta-id="f105d559d6134d4bb0bfc06c8b6cb240"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="fas fa-archive fa-2x text-gray-300" data-structr-meta-id="8732bf72e1b24d16ae396b664d66434b"></i></div>
						</div>
					</div>
				</div>
			</a></div>
	</div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!-- Content Row -->
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<div class="row" data-structr-meta-id="18b0d9ffc6ea455980ffd2f3cc40ee33">
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-12" data-structr-meta-id="570fe250f6f943b4bb6b73c3425cfff2">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div class="card shadow mb-4" data-structr-meta-id="95683de3a618407ea9b334736e415668">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between" data-structr-meta-id="e0a91b7bb41c4a3ebd81cd9e3b522675">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<h6 class="m-0 font-weight-bold text-primary" data-structr-meta-id="2499761ab4ac466ea16cede945caa5b3"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Topology</h6>
				</div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!-- Card Body -->
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-body" id="graph-container" data-structr-meta-id="816b7ed437b84087aa79c31f587e9034"></div>
			</div>
		</div>
	</div>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<style type="text/css" data-structr-meta-id="2d4a7e50d1bc43069056922750826f77"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/css) -->#graph-container {

	height : 55vh;
	width  : 100%;
	border : 1px solid lightgray;

}</style>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<script src="/js/vis-network.min.js" type="text/javascript" data-structr-meta-id="8ccdc5bc6be44ada8ed5112e735e166d"></script>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<script type="text/javascript" data-structr-meta-id="0c13019e840d4cd08aca9880de5b38d2"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/javascript) -->function readFilters() {

}

function buildGetString(parameters) {

	const keyValuePairs = [];
	for(let key in parameters) {
	
		let value = parameters[key];
		let keyValuePair = key + '=' + value;
		keyValuePairs.push(keyValuePair);
	
	}
	
	const prefix = keyValuePairs.length ? '?' : '';
	const getString = prefix + keyValuePairs.join('&amp;');
	return getString;
	
}

async function drawNetworkTopology() {
	
	let options = {
		groups : {
			VALID : {
				background: 'rgb(189,215,238)',
          		border: 'rgb(46,117,182)',
			},
			INVALID : {
				background: 'rgb(46,117,182)',
            	border: 'rgb(46,117,182)'
			},
			UNKNOWN : {}
		},
		layout : {
			hierarchical : {
				direction    : 'UD',
				sortMethod   : 'directed',
				shakeTowards : 'roots'
			}
		},
		edges : {
			arrows : 'to'
		}
	};
	
	let container = document.getElementById('graph-container');

	let getString  = '?network=6459577e53674eb185b2caf10f545f93'
	let uri        = '/endpoints/network-topology' + getString;
	let encodedUrl = encodeURI(uri);
	
	fetch(encodedUrl)
	.then(response =&gt; response.json())
	.then(data =&gt; {
		let graph = new vis.Network(container, data, options);
		graph.on('doubleClick', async function (parameters) {

			let nodes = parameters['nodes'];
			if(nodes) {

				let uri = encodeURI('/structr/rest/Demo_BaseType/' + nodes[0]);
				let response = await fetch(uri);
				let text     = await response.text();
				let result   = JSON.parse(text);
				let nodeProperties = result.result;

				switch(nodeProperties.type) {

					case 'Demo_Equipment':
						window.location = '/equipment/' + nodes[0];
						break;
					case 'Demo_Drawing':
						window.location = '/drawing/' + nodes[0];
						break;
					case 'Demo_Datasheet':
						window.location = '/datasheet/' + nodes[0];
						break;
					case 'Demo_Deliverable':
						window.location = '/deliverable/' + nodes[0];
						break;
					case 'Demo_Workpack':
						window.location = '/workpack/' + nodes[0];
						break;

				}

			}

		});

		
	});
	
	//let endpoint   = await fetch(encodedUrl);
	//let text       = await endpoint.text();
	//let data       = JSON.parse(text);

}


if (document.fonts) {
	// Decent browsers: Make sure the fonts are loaded.
	document.fonts
		.load('normal normal 900 24px/1 "Font Awesome 5 Free"')
		.catch(console.error.bind(console, "Failed to load Font Awesome 5."))
		.then(function () {
			// create a network
			drawNetworkTopology();
		})
		.catch(
			console.error.bind(
			console,
			"Failed to render the network with Font Awesome 5."
		)
	);
} else {
	// IE: Let's just hope the fonts are loaded (they're probably not,
	// hence the timeout).
	window.addEventListener("load", function () {
		setTimeout(function () {
			// create a network
			drawNetworkTopology();
		}, 1000);
	});
}</script>
</structr:template>
