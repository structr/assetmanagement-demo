<!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><structr:template src="Main Page Template-a5217bf8d0ac4da3b7613e526779dfca" data-structr-meta-name="Main Page Template" data-structr-meta-id="44353c0473224b8ebd3d99150feb10e1"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Form-->
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<div class="row" data-structr-meta-id="3b9c4190aaca4d65b93fb20cc3e9a75d">
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-12" data-structr-meta-id="112de42c59724d9784eacc1a1fe25dc2">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div class="card shadow mb-4" data-structr-meta-id="1a2768e084de4b438f15d815938b0c12">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between" data-structr-meta-id="a0ecf9adcea143b39d20943f4e6f6d13">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<h6 class="m-0 font-weight-bold text-primary" data-structr-meta-id="41e2d60e7a6a49748eb0b30042f891c3"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Clause</h6>
				</div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-body" data-structr-meta-id="2cd9192b8e064a368e1db29910c1e115">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="0d1bdcd9fae4473c859be2da66ef895a">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="de32db8937664f8dad9c8c372094ad16"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Name</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<input class="col-9 form-control" id="name" value="${current.name}" data-structr-meta-id="9834d71c0a4f4963bed0242c7bd8bcd6">
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="29c93f3419664ebebb59ea10b1b2fc91">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="9470a8a6b6444041a2ab74a5764fdd85"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Equipment Type</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="type" data-structr-meta-id="2ad2b89481eb4ef9b7d1a74a7d906fc9">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="0d1e4160faf94278bd859f9d84f62297"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.equipmentType,equipmentType),'selected')}" value="${equipmentType}" data-structr-meta-id="c469e9bcd3014624b9629ddd145416c7" data-structr-meta-data-key="equipmentType" data-structr-meta-function-query="sort(find('Demo_EquipmentType'), 'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${equipmentType.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="ea9ae2047a6c426ebc704c33bdf6bfd0">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="1f382c5bd7fa4261bb4a7ed5ed2eb053"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Description</label><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><textarea class="col-9 form-control" id="description" rows="15" data-structr-meta-id="ce3c229bc9de45a8ac47d195afe4e04d"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.description}</textarea>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="e54a846432964d3cba7a6e733c84bb1e">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="c5a1ef2742894a738076f6239c89ea31"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Standards &amp; Regulations</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="standard-and-regulation" data-structr-meta-id="96c2ac07ee0d447db087c7343891bc55">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="248f26a231f14ea39a3a3bd733f1c7ba"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.standardAndRegulation,standardAndRegulation),'selected')}" value="${standardAndRegulation}" data-structr-meta-id="eed792922c6a41e8809cf29ff5cfa520" data-structr-meta-data-key="standardAndRegulation" data-structr-meta-function-query="sort(find('Demo_StandardAndRegulation'), 'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${standardAndRegulation.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="989d6dbe4a7c4b08b8c00b748a6a8cfd">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="892dd755ca344e488555b971391dc56b"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Graph</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="graph" data-structr-meta-id="79c5f0ecd0b04905958fcdbc848d7214">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="b362af36be634f84ae964e4161dde4b4"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.graph,graph)'selected')}" value="${graph}" data-structr-meta-id="5a5e04424c224c74b93114e4352d7485" data-structr-meta-data-key="graph" data-structr-meta-function-query="sort(find('Demo_Graph'),'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${graph.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<structr:component src="Edit Buttons-960733b24fd049468ef8e0581ef02e7b" data-structr-meta-name="Edit Buttons" data-structr-meta-id="0b3cb7758f4c498392e0cbec371fef26">
					</structr:component>
				</div>
			</div>
		</div>
	</div>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<script type="text/javascript" data-structr-meta-id="110ebe4784ce45999a4cd2d3943fca4e"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/javascript) -->async function loadPartial(url, domNode) {

	const encodedUrl = encodeURI(url);
	const page = await fetch(encodedUrl);
	const html = await page.text();
	domNode.innerHTML = html;

}

async function reloadPage(componentId) {

	const mainContainer = document.getElementById('main-container');

	if(componentId) {
		window.location.href = '/clause/' + componentId;
	} else {
		window.location.href = '/clauses';
	}
	
}

function collectComponentProperties() {

	const properties = {};
	
	// collect node properties
	const nameInput                  = document.getElementById('name');
	const typeInput                  = document.getElementById('type');
	const descriptionInput           = document.getElementById('description');
	const standardAndRegulationInput = document.getElementById('standard-and-regulation');
	const graphInput                 = document.getElementById('graph');
	
	// ${current} is the uuid of the current detail object from the URL path /page.name/&lt;id&gt;
	if('${current}')               properties['id']                    = '${current}';
	if(nameInput)                  properties['name']                  = nameInput.value;
	if(typeInput)                  properties['equipmentType']         = typeInput.value;
	if(descriptionInput)           properties['description']           = descriptionInput.value;
	if(standardAndRegulationInput) properties['standardAndRegulation'] = standardAndRegulationInput.value;
	if(graphInput)                 properties['graph']                 = graphInput.value;
	
	return properties;

}

async function getId(response) {

	const rawResult = await response.text();
	const result    = JSON.parse(rawResult);
	const id        = result.result[0];
	
	return id;

}

async function createComponent(event) {
	
	const properties = collectComponentProperties();

	const response = await fetch('/structr/rest/Demo_Clause', {
		headers: new Headers(),
		method: 'POST',
		body: JSON.stringify(properties),
		credentials: 'same-origin'
	});
	const id = await getId(response);
	
	reloadPage(id);
	
}

async function saveComponent() {
	
	const properties  = collectComponentProperties();
	const componentId = properties['id'];
	
	if(componentId) {
	
		await fetch('/structr/rest/Demo_Clause/' + componentId, {
			headers: new Headers(),
			method: 'PUT',
			body: JSON.stringify(properties),
			credentials: 'same-origin'
		});
	
	}
	
	reloadPage('${current}');
	
}

async function deleteComponent() {
	
	const properties  = collectComponentProperties();
	const componentId = properties['id'];
	
	if(componentId) {
	
		await fetch('/structr/rest/Demo_Clause/' + componentId, {
			headers: new Headers(),
			method: 'DELETE',
			credentials: 'same-origin'
		});
	
	}
	
	reloadPage();
	
}

async function cancelComponent() {
	
	reloadPage('${current}');
	
}





/******************************************************************************\
 #MAIN
\******************************************************************************/

document.addEventListener('DOMContentLoaded', function() {
	
	// hook CREATE button
	const createButton = document.getElementById('create-component');
	if(createButton) {
		createButton.addEventListener('click', createComponent);
	}
	
	// hook SAVE button
	const saveButton = document.getElementById('save-component');
	if(saveButton) {
		saveButton.addEventListener('click', saveComponent);
	}
	
	// hook DELETE button
	const deleteButton = document.getElementById('delete-component');
	if(deleteButton) {
		deleteButton.addEventListener('click', deleteComponent);
	}
	
	// hook CANCEL button
	const cancelButton = document.getElementById('cancel-component');
	if(cancelButton) {
		cancelButton.addEventListener('click', cancelComponent);
	}

});</script>
</structr:template>
