<!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><structr:template src="Main Page Template-a5217bf8d0ac4da3b7613e526779dfca" data-structr-meta-name="Main Page Template" data-structr-meta-id="340bb13b80384391a20805396f1b1790"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--References-->
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<div class="row" data-structr-meta-id="e95d55be1ac048fda2a87ff8b54c85f7" data-structr-meta-hide-conditions="empty(current)"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Invalid Drawings-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-md-6 mb-4" data-structr-meta-id="82ba21aada674fb1b95f573ad0625f6c">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div class="card border-left-info shadow h-100 py-2" data-structr-meta-id="e5e4333b1d0842129959a4e8a897ff63">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-body" data-structr-meta-id="182f99196f644d2d96f83c633f68ab50">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row no-gutters align-items-center" data-structr-meta-id="eb73a7f018c540d4a04bff157b98b3a2">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="col mr-2" data-structr-meta-id="ae969f0e958c42bebe1cef1d0df456b0">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="text-xs font-weight-bold text-info text-uppercase mb-1" data-structr-meta-id="f34755149eaa4ceaaf404321c56da12c"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Invalid Drawings</div><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a class="btn btn-danger mr-1" href="/drawing/${drawing}" data-structr-meta-id="478adc3e4d8644dab321305dd0974710" data-structr-meta-data-key="drawing" data-structr-meta-function-query="{

  const workpack = $.get('current');
  const drawings = $.sort(workpack.drawings, 'name');
  const invalidDrawings = drawings.filter(d =&gt; d.computedStatus === 'INVALID');

  return invalidDrawings;

}"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${drawing.name}</a>
						</div>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="col-auto" data-structr-meta-id="30a1181182244cb58f96e03648c3ef82"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="fas fa-paint-brush text-gray-300" data-structr-meta-id="9d338ee651074e28920d547006f52e02"></i></div>
					</div>
				</div>
			</div>
		</div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Invalid Datasheets-->
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-md-6 mb-4" data-structr-meta-id="f073ee63c7ce46c7aa87958323db323a">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div class="card border-left-warning shadow h-100 py-2" data-structr-meta-id="c5b73f9bf20d44aba1b58058fb2e1c4a">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-body" data-structr-meta-id="98bde36d42414e9b81aada102179357c">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row no-gutters align-items-center" data-structr-meta-id="10da036ba73d4df292dacc5e41a9b378">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="col mr-2" data-structr-meta-id="7f4a415e064244daacd03a9388c9b838">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<div class="text-xs font-weight-bold text-warning text-uppercase mb-1" data-structr-meta-id="7d34d01425814ce5b3d89b54ff7dd85a"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Invalid Datasheets</div><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a class="btn btn-danger mr-1" href="/datasheet/${datasheet}" data-structr-meta-id="8495015deb0044469b3a1d55cb76064f" data-structr-meta-data-key="datasheet" data-structr-meta-function-query="{

  const workpack = $.get('current');
  const datasheets = $.sort(workpack.datasheets, 'name');
  const invalidDatasheets = datasheets.filter(d =&gt; d.computedStatus === 'INVALID');

  return invalidDatasheets;

}"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${datasheet.name}</a>
						</div>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<div class="col-auto" data-structr-meta-id="c43369fb37f2479b8236390419ed5ef8"><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><i class="fas fa-file-alt text-gray-300" data-structr-meta-id="b1fc9c9e22d44d1cb0633fdb04e206ae"></i></div>
					</div>
				</div>
			</div>
		</div>
	</div><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><!--Form-->
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<div class="row" data-structr-meta-id="934ccc3929df4fe8b85d2fe60eadf661">
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div class="col-12" data-structr-meta-id="013fb4f3e6e8494ca0afb17a2e6f6ca0">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div class="card shadow mb-4" data-structr-meta-id="d1da55193379480eba07fb266c47681b">
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between" data-structr-meta-id="c8d111e35ac244d39f41a2e89fd0f442">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<h6 class="m-0 font-weight-bold text-primary" data-structr-meta-id="c72a0b102e66439d951f5c44d1229f6d"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Workpack</h6>
				</div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<div class="card-body" data-structr-meta-id="e9ddd463aed244dfa96861ff7a7d98fa">
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="29f6c8bdf0e14f7ea64df04736a0b219">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="c37a3845f5f0403a8955bae9d6ce5e68"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Name</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<input class="col-9 form-control" id="name" value="${current.name}" data-structr-meta-id="8d9f9bca5923445cafe6c112c79adb9d">
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="e76c1220e31e49cbb7822807b3e56f9c">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="93f61057c93b4dfe912049f3d2a29598"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Status</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="status" data-structr-meta-id="8fc7d206f5084875ad7e492761a5eb26">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.status,'VALID'),'selected')}" data-structr-meta-id="4590350898fb4d7d80d7665d36a98bd3"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->valid</option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.status,'INVALID'),'selected')}" data-structr-meta-id="69d44c86039b4d45a1ed679f58e976af"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->invalid</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="689398c3d1ab42a6a6da42091703b564">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="cea3a94074524afe8f826f9899c8a5b1"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Description</label><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><textarea class="col-9 form-control" id="description" data-structr-meta-id="0cb4367e4e3249109282e35e0a3e5a2b"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.description}</textarea>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="2fc9adeff83c41c3a03240e58e66034d">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="c4069bed3663402e90e3575395426d5a"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Persons</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="persons" multiple="multiple" data-structr-meta-id="7fd21478ea054f8780d2eb5fcb8d1382">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="6ff229cac8ae4461beee390ccc372f35"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(contains(current.persons,person)'selected')}" value="${person}" data-structr-meta-id="67a075f977a345aabafcca53794e51ef" data-structr-meta-data-key="person" data-structr-meta-function-query="sort(find('Demo_Person'),'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${person.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="8165dce61ee54c2e800bd3a043f24db2">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="a2f0f76c1a2e47aebe470e17abb63991"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Datasheets</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="datasheets" multiple="multiple" data-structr-meta-id="5e064d0625c241dcbfae5ee9651eab71">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="4904a75873d040fe915a56efb18a3b6f"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(contains(current.datasheets,datasheet)'selected')}" value="${datasheet}" data-structr-meta-id="603e20999f5d4abe894e10539cb0fb53" data-structr-meta-data-key="datasheet" data-structr-meta-function-query="sort(find('Demo_Datasheet'),'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${datasheet.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="3f5b1ac22347490c8bda12e7ef75fda4">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="11b625730e904974accbcafb57bff4e6"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Drawings</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="drawings" multiple="multiple" data-structr-meta-id="f84285593a5d48d9a53871389d380fa0">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="6f9e19a5b5194cdfa0950f98094bf7f0"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(contains(current.drawings,drawing)'selected')}" value="${drawing}" data-structr-meta-id="510dce14dbc54525a306f211fc5e869b" data-structr-meta-data-key="drawing" data-structr-meta-function-query="sort(find('Demo_Drawing'),'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${drawing.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<div class="row mb-4" data-structr-meta-id="c813eb2da3844dd18e4a269f26526a3e">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<label class="col-3" data-structr-meta-id="363473c279004c23b183236cdd4dcb22"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Graph</label>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<select class="col-9 form-control select2-input" id="graph" data-structr-meta-id="f204c4e9a13140d4becb3fa8d69b8104">
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option data-structr-meta-id="e095de414fa74b0bb2f936e2f259ae90"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) --></option>
							<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
							<option selected="${is(equal(current.graph,graph)'selected')}" value="${graph}" data-structr-meta-id="3cbdeeb71dd840bc8e321173006a353e" data-structr-meta-data-key="graph" data-structr-meta-function-query="sort(find('Demo_Graph'),'name')"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${graph.name}</option>
						</select>
					</div>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<structr:component src="Edit Buttons-960733b24fd049468ef8e0581ef02e7b" data-structr-meta-name="Edit Buttons" data-structr-meta-id="88492786fce84c5c95248ecae142311f">
					</structr:component>
				</div>
			</div>
		</div>
	</div>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<script type="text/javascript" data-structr-meta-id="3746cf7e099a4e07acd51bcd74ad1805"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/javascript) -->async function loadPartial(url, domNode) {

	const encodedUrl = encodeURI(url);
	const page = await fetch(encodedUrl);
	const html = await page.text();
	domNode.innerHTML = html;

}

async function reloadPage(componentId) {

	const mainContainer = document.getElementById('main-container');

	if(componentId) {
		window.location.href = '/workpack/' + componentId;
	} else {
		window.location.href = '/workpacks';
	}
	
}

function collectComponentProperties() {

	const properties = {};
	
	// collect node properties
	const name        = document.getElementById('name');
	const status      = document.getElementById('status');
	const description = document.getElementById('description');
	const persons     = document.getElementById('persons');
	const datasheets  = document.getElementById('datasheets');
	const drawings    = document.getElementById('drawings');
	const graph       = document.getElementById('graph');
	
	// ${current} is the uuid of the current detail object from the URL path /page.name/&lt;id&gt;
	if('${current}') properties['id']          = '${current}';
	if(name)         properties['name']        = name.value;
	if(status)       properties['status']      = status.value.toUpperCase();
	if(description)  properties['description'] = description.value;
	if(persons)      properties['persons']     = $(persons).val();
	if(datasheets)   properties['datasheets']  = $(datasheets).val();
	if(drawings)     properties['drawings']    = $(drawings).val();	
	if(graph)        properties['graph']       = graph.value;
	
	return properties;

}

async function getId(response) {

	const rawResult = await response.text();
	const result    = JSON.parse(rawResult);
	const id        = result.result[0];
	
	return id;

}

async function createComponent(event) {
	
	const properties = collectComponentProperties();

	const response = await fetch('/structr/rest/Demo_Workpack', {
		headers: new Headers(),
		method: 'POST',
		body: JSON.stringify(properties),
		credentials: 'same-origin'
	});
	const id = await getId(response);
	
	reloadPage(id);
	
}

async function saveComponent() {
	
	const properties  = collectComponentProperties();
	const componentId = properties['id'];
	
	if(componentId) {
	
		await fetch('/structr/rest/Demo_Workpack/' + componentId, {
			headers: new Headers(),
			method: 'PUT',
			body: JSON.stringify(properties),
			credentials: 'same-origin'
		});
	
	}
	
	reloadPage('${current}');
	
}

async function deleteComponent() {
	
	const properties  = collectComponentProperties();
	const componentId = properties['id'];
	
	if(componentId) {
	
		await fetch('/structr/rest/Demo_Workpack/' + componentId, {
			headers: new Headers(),
			method: 'DELETE',
			credentials: 'same-origin'
		});
	
	}
	
	reloadPage();
	
}

async function cancelComponent() {
	
	reloadPage('${current}');
	
}





/******************************************************************************\
 #MAIN
\******************************************************************************/

document.addEventListener('DOMContentLoaded', function() {
	
	// hook CREATE button
	const createButton = document.getElementById('create-component');
	if(createButton) {
		createButton.addEventListener('click', createComponent);
	}
	
	// hook SAVE button
	const saveButton = document.getElementById('save-component');
	if(saveButton) {
		saveButton.addEventListener('click', saveComponent);
	}
	
	// hook DELETE button
	const deleteButton = document.getElementById('delete-component');
	if(deleteButton) {
		deleteButton.addEventListener('click', deleteComponent);
	}
	
	// hook CANCEL button
	const cancelButton = document.getElementById('cancel-component');
	if(cancelButton) {
		cancelButton.addEventListener('click', cancelComponent);
	}

});</script>
</structr:template>
